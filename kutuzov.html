<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>Kutuzov</title>
	<script>
		if (
			!window.File ||
			!window.FileReader ||
			!window.Blob
		) {
			alert('Your browser incompatible with Kutuzov. No luck.');
		}
	</script>
	<style>
		#output{width:100%;text-align:center;font-size:24px;height:50px;line-height:50px;}
	</style>
</head>
<body>
	<input id="file" name="file" type="file" />
	<div id="output"></div>

	<script>
		document.getElementById('file').addEventListener('change', handleFileSelect, false);

		function handleFileSelect(ev) {
			var file = ev.target.files[0]

			if (!file) {
				console.log('no file selected');
				return;
			}

			if (file.type != 'text/plain') {
				alert('Kutuzov can\'t see anything except old plain text files.');
				return;
			}

			var reader = new FileReader();

			reader.onloadend = function(ev) { handleFileLoad(ev, reader) };
			reader.readAsText(file);
		}

		function handleFileLoad(ev, reader) {
			var container = document.getElementById('output');

			// HERE
			var iterator = new ktzIterator(reader.result.split(/\s+/));
			var drawer = new ktzDrawer(iterator, container);

			var interval = setInterval(function () {
					if (!drawer()) {
						clearInterval(interval);
						console.log('cleared');
					}
			}, 300);
		}

		function ktzIterator(arr) {
			this.arr = arr;
			this.pos = 0;
			this.len = arr.length;

			this.next = function() {
				if (this.pos >= this.len) {
					return false;
				}

				console.log('next, pos ' + this.pos + ', word "' + this.arr[this.pos] + '"');

				this.pos++;

				return this.arr[this.pos - 1];
			}
		}

		function ktzDrawer(iterator, container) {
			return function () {
				word = iterator.next();

				if (word == false) {
					return false;
				}

				container.textContent = word;

				console.log('tick ' + word);

				return true;
			}
		}
	</script>
</body>
</html>
